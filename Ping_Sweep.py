#!/usr/bin/python
from scapy.all import *
import netaddr

#
#Read in file, ping sweep the entitre network, write result to file
#

def ping_sweep(network, hosts):
    addresses = []

    for i in range(hosts):
        host = network + str(i+1)
        addresses.append(host)
    print(addresses)
    #addresses = ['192.168.178.1', '192.168.178.2', '192.168.178.3', '192.168.178.4', '192.168.178.5', '192.168.178.6', '192.168.178.7', '192.168.178.8', '192.168.178.9', '192.168.178.10', '192.168.178.11', '192.168.178.12', '192.168.178.13', '192.168.178.14', '192.168.178.15', '192.168.178.16', '192.168.178.17', '192.168.178.18', '192.168.178.19', '192.168.178.20', '192.168.178.21', '192.168.178.22', '192.168.178.23', '192.168.178.24', '192.168.178.25', '192.168.178.26', '192.168.178.27', '192.168.178.28', '192.168.178.29', '192.168.178.30', '192.168.178.31', '192.168.178.32', '192.168.178.33', '192.168.178.34', '192.168.178.35', '192.168.178.36', '192.168.178.37', '192.168.178.38', '192.168.178.39', '192.168.178.40', '192.168.178.41', '192.168.178.42', '192.168.178.43', '192.168.178.44', '192.168.178.45', '192.168.178.46', '192.168.178.47', '192.168.178.48', '192.168.178.49', '192.168.178.50', '192.168.178.51', '192.168.178.52', '192.168.178.53', '192.168.178.54', '192.168.178.55', '192.168.178.56', '192.168.178.57', '192.168.178.58', '192.168.178.59', '192.168.178.60', '192.168.178.61', '192.168.178.62', '192.168.178.63', '192.168.178.64', '192.168.178.65', '192.168.178.66', '192.168.178.67', '192.168.178.68', '192.168.178.69', '192.168.178.70', '192.168.178.71', '192.168.178.72', '192.168.178.73', '192.168.178.74', '192.168.178.75', '192.168.178.76', '192.168.178.77', '192.168.178.78', '192.168.178.79', '192.168.178.80', '192.168.178.81', '192.168.178.82', '192.168.178.83', '192.168.178.84', '192.168.178.85', '192.168.178.86', '192.168.178.87', '192.168.178.88', '192.168.178.89', '192.168.178.90', '192.168.178.91', '192.168.178.92', '192.168.178.93', '192.168.178.94', '192.168.178.95', '192.168.178.96', '192.168.178.97', '192.168.178.98', '192.168.178.99', '192.168.178.100', '192.168.178.101', '192.168.178.102', '192.168.178.103', '192.168.178.104', '192.168.178.105', '192.168.178.106', '192.168.178.107', '192.168.178.108', '192.168.178.109', '192.168.178.110', '192.168.178.111', '192.168.178.112', '192.168.178.113', '192.168.178.114', '192.168.178.115', '192.168.178.116', '192.168.178.117', '192.168.178.118', '192.168.178.119', '192.168.178.120', '192.168.178.121', '192.168.178.122', '192.168.178.123', '192.168.178.124', '192.168.178.125', '192.168.178.126', '192.168.178.127', '192.168.178.128', '192.168.178.129', '192.168.178.130', '192.168.178.131', '192.168.178.132', '192.168.178.133', '192.168.178.134', '192.168.178.135', '192.168.178.136', '192.168.178.137', '192.168.178.138', '192.168.178.139', '192.168.178.140', '192.168.178.141', '192.168.178.142', '192.168.178.143', '192.168.178.144', '192.168.178.145', '192.168.178.146', '192.168.178.147', '192.168.178.148', '192.168.178.149', '192.168.178.150', '192.168.178.151', '192.168.178.152', '192.168.178.153', '192.168.178.154', '192.168.178.155', '192.168.178.156', '192.168.178.157', '192.168.178.158', '192.168.178.159', '192.168.178.160', '192.168.178.161', '192.168.178.162', '192.168.178.163', '192.168.178.164', '192.168.178.165', '192.168.178.166', '192.168.178.167', '192.168.178.168', '192.168.178.169', '192.168.178.170', '192.168.178.171', '192.168.178.172', '192.168.178.173', '192.168.178.174', '192.168.178.175', '192.168.178.176', '192.168.178.177', '192.168.178.178', '192.168.178.179', '192.168.178.180', '192.168.178.181', '192.168.178.182', '192.168.178.183', '192.168.178.184', '192.168.178.185', '192.168.178.186', '192.168.178.187', '192.168.178.188', '192.168.178.189', '192.168.178.190', '192.168.178.191', '192.168.178.192', '192.168.178.193', '192.168.178.194', '192.168.178.195', '192.168.178.196', '192.168.178.197', '192.168.178.198', '192.168.178.199', '192.168.178.200', '192.168.178.201', '192.168.178.202', '192.168.178.203', '192.168.178.204', '192.168.178.205', '192.168.178.206', '192.168.178.207', '192.168.178.208', '192.168.178.209', '192.168.178.210', '192.168.178.211', '192.168.178.212', '192.168.178.213', '192.168.178.214', '192.168.178.215', '192.168.178.216', '192.168.178.217', '192.168.178.218', '192.168.178.219', '192.168.178.220', '192.168.178.221', '192.168.178.222', '192.168.178.223', '192.168.178.224', '192.168.178.225', '192.168.178.226', '192.168.178.227', '192.168.178.228', '192.168.178.229', '192.168.178.230', '192.168.178.231', '192.168.178.232', '192.168.178.233', '192.168.178.234', '192.168.178.235', '192.168.178.236', '192.168.178.237', '192.168.178.238', '192.168.178.239', '192.168.178.240', '192.168.178.241', '192.168.178.242', '192.168.178.243', '192.168.178.244', '192.168.178.245', '192.168.178.246', '192.168.178.247', '192.168.178.248', '192.168.178.249', '192.168.178.250', '192.168.178.251', '192.168.178.252', '192.168.178.253', '192.168.178.254']
    Livehosts = []
    # Send ICMP ping request, wait for answer
    for host in addresses:
        print(f'ip = {host}')
        #if (host == addresses.network or host == addresses.broadcast):
         #   continue
        try:
           #resp = sr1(IP(dst=str(host))/ICMP(),inter=.1,timeout=1,retry=0,verbose=0)
           response, geen = srp(Ether(dst="ff:ff:ff:ff:ff:ff") / ARP(pdst=host), timeout=2)
           #print(response)
           antw = str(response.__repr__())
           #print(antw)
           if 'Other:1' in antw:
               print(f'{host} is alive')
               Livehosts.append(host)
           else:
               print(f'{host} is not use?')

        except:
            print(f'{host} is fout ingevoerd?.')
            pass






        #elif (int(resp.getlayer(ICMP).type)==3 and int(resp.getlayer(ICMP).code) in [1,2,3,9,10,13]):
         #   print (str(host) + " is blocking ICMP.")


    return Livehosts



#ping_sweep('192.168.178.', 254)
